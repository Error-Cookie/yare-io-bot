(()=>{{let n=function(t){if(t.player_id!=base.player_id)return"enemy";if(stats.charge_chain<4*charge_squads){if(memory.squads.filter(e=>e.type=="charge_squad"&&e.squad.length>=3).length<h())return"charge_chain";if(stats.charge_chain==4*charge_squads-1)return"charge_chain"}else return"drone"},h=function(){return Math.round(memory.star.energy/100)+3},r=function(t,e){let s=Math.pow(t[0]-e[0],2),i=Math.pow(t[1]-e[1],2);return Math.sqrt(s+i)},u=function(t,e,s){let i=-s/r(t,e);return[t[0]+(t[0]-e[0])*i,t[1]+(t[1]-e[1])*i]},g=function(t,e){return Math.round(t[0])==Math.round(e[0])&&Math.round(t[1])==Math.round(e[1])},o=function(t){var e=Math.floor(t/6e4),s=(t%6e4/1e3).toFixed(0);return s==60?e+1+":00":e+":"+(s<10?"0":"")+s};_=n,d=h,f=r,m=u,q=g,y=o,log=!0,reinstance_spirits=!1,charge_squads=13,charge_chain=[195,350,520],stats={my_spirits:0,enemy_spirits:0,my_alive_spirits:0,enemy_alive_spirits:0,charge_chain:0};let a=my_spirits.filter(t=>t.hp>0);memory.star||(memory.star=r(base.position,star_a1c.position)>r(base.position,star_zxq.position)?star_zxq:star_a1c),memory.squads||(memory.squads=[]);class p{constructor(e){this.spirit=e,this.type=n(e),this.squad=null,this.range=197}get id(){return this.spirit.id}get pos(){return this.spirit.position}get size(){return this.spirit.size}get encap(){return this.spirit.energy_capacity}get energy(){return this.spirit.energy}get hp(){return this.spirit.hp}get mark(){return this.spirit.mark}set mark(e){return this.spirit.set_mark(e)}get sight(){return this.spirit.sight}get isFull(){return this.energy==this.encap}get isDead(){return this.hp<=0}get danger(){return this.sight.enemies>0}get starNearby(){return r(memory.star.position,this.pos)<=this.range}get baseNearby(){return r(base.position,this.pos)<=this.range}energize(e){return this.spirit.energize(e)}move(e){return this.spirit.move(e)}merge(e){return this.spirit.merge(e)}divide(){return this.spirit.divide()}say(e){return this.spirit.shout(e)}charge(){return this.energize(this.spirit)}findSquad(e){let s=memory.squads.filter(i=>!i.isFull&&i.type==e);if(s.length>0)s[0].squad.push(this),this.squad=s[0];else{let i=new c([this],e);memory.squads.push(i),this.squad=i}}}class c{constructor(e,s){this.squad=e,this.type=s}get isFull(){if(this.type=="charge_squad")return this.squad.length==4}work(){if(this.type=="charge_squad")return this.chargeSquad()}chargeSquad(){if(!this.isFull)return"no_work";for(let e=0;e<this.squad.length;e++){let s=this.squad[e];if(s.hp<=0)return this.squad.splice(e,1),"no_work";let i=e%4==3?0:e%4,l=u(memory.star.position,base.position,charge_chain[i]);g(l,s.pos)?s.baseNearby?s.energize(base):s.starNearby?(e%4==3?this.squad[0].mark=="charge"?s.mark="transfer":s.mark="charge":s.isFull?s.mark="transfer":s.energy==0&&(s.mark="charge"),s.mark=="charge"?s.charge():s.energize(this.squad[1])):s.energize(this.squad[e+1]):s.move(l)}}}Object.values(spirits).forEach(t=>{(!memory[t.id]||reinstance_spirits)&&(memory[t.id]=new p(t)),t.player_id==base.player_id?stats.my_spirits++:stats.enemy_spirits++,t.hp>0&&(memory[t.id].type=="charge_chain"&&stats.charge_chain++,t.player_id==base.player_id?stats.my_alive_spirits++:stats.enemy_alive_spirits++)}),log&&console.log(`
        ${o(tick*600)} |
        Tick: ${tick} |
        ChargeChain: ${stats.charge_chain}/${charge_squads*4} |
        Player: ${stats.my_alive_spirits}/${stats.my_spirits} |
        Enemy: ${stats.enemy_alive_spirits}/${stats.enemy_spirits}
    `);for(let t=0;t<a.length;t++){let e=memory[a[t].id];e.type=="charge_chain"?e.squad||e.findSquad("charge_squad"):e.move(base.position)}memory.squads.forEach(t=>t.work())}var _,d,f,m,q,y;})();
